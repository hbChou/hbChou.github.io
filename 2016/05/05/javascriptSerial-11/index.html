<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>你所不知道的javascript（十一） | hbChou</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这一节让我们来总结一些常见的前端优化方案。



浏览器是如何渲染页面的
回流与重绘
哪些操作会引起回流或重绘
如何减少回流或者重绘


雅虎军规
延伸扩展
iframe的优缺点
什么是CDN
高效的css






浏览器是如何渲染页面的
根据来自服务器端的HTML代码形成文档对象模型（DOM）
加载并解析样式，形成CSS对象模型
在文档对象模型和CSS对象模型之上，创建一棵由一组待生成渲染的">
<meta property="og:type" content="article">
<meta property="og:title" content="你所不知道的javascript（十一）">
<meta property="og:url" content="http://yoursite.com/2016/05/05/javascriptSerial-11/index.html">
<meta property="og:site_name" content="hbChou">
<meta property="og:description" content="这一节让我们来总结一些常见的前端优化方案。



浏览器是如何渲染页面的
回流与重绘
哪些操作会引起回流或重绘
如何减少回流或者重绘


雅虎军规
延伸扩展
iframe的优缺点
什么是CDN
高效的css






浏览器是如何渲染页面的
根据来自服务器端的HTML代码形成文档对象模型（DOM）
加载并解析样式，形成CSS对象模型
在文档对象模型和CSS对象模型之上，创建一棵由一组待生成渲染的">
<meta property="og:updated_time" content="2016-05-05T06:07:49.121Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你所不知道的javascript（十一）">
<meta name="twitter:description" content="这一节让我们来总结一些常见的前端优化方案。



浏览器是如何渲染页面的
回流与重绘
哪些操作会引起回流或重绘
如何减少回流或者重绘


雅虎军规
延伸扩展
iframe的优缺点
什么是CDN
高效的css






浏览器是如何渲染页面的
根据来自服务器端的HTML代码形成文档对象模型（DOM）
加载并解析样式，形成CSS对象模型
在文档对象模型和CSS对象模型之上，创建一棵由一组待生成渲染的">
  
    <link rel="alternative" href="/atom.xml" title="hbChou" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/image.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">hbChou</a></h1>
		</hgroup>

		
		<p class="header-subtitle">每天都要有所收获</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/hbChou" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/3301672992?s=6cm7D0&is_all=1" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/zhou-hai-bin-63" title="zhihu">zhihu</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/javascript/" style="font-size: 10px;">javascript</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://segmentfault.com/">segmentfault社区</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我就是我，是颜色不一样的烟火</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">hbChou</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/image.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">hbChou</h1>
			</hgroup>
			
			<p class="header-subtitle">每天都要有所收获</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/hbChou" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/3301672992?s=6cm7D0&is_all=1" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/zhou-hai-bin-63" title="zhihu">zhihu</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-javascriptSerial-11" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/05/javascriptSerial-11/" class="article-date">
  	<time datetime="2016-05-05T01:21:18.000Z" itemprop="datePublished">2016-05-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      你所不知道的javascript（十一）
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这一节让我们来总结一些常见的前端优化方案。</p>
<hr>
<!-- MarkdownTOC -->
<ul>
<li><a href="#浏览器是如何渲染页面的"><strong>浏览器是如何渲染页面的</strong></a></li>
<li><a href="#回流与重绘"><strong>回流与重绘</strong></a><ul>
<li><a href="#哪些操作会引起回流或重绘"><strong>哪些操作会引起回流或重绘</strong></a></li>
<li><a href="#如何减少回流或者重绘"><strong>如何减少回流或者重绘</strong></a></li>
</ul>
</li>
<li><a href="#雅虎军规"><strong>雅虎军规</strong></a></li>
<li><a href="#延伸扩展"><strong>延伸扩展</strong></a><ul>
<li><a href="#iframe的优缺点"><strong>iframe的优缺点</strong></a></li>
<li><a href="#什么是cdn"><strong>什么是CDN</strong></a></li>
<li><a href="#高效的css"><strong>高效的css</strong></a></li>
</ul>
</li>
</ul>
<!-- /MarkdownTOC -->
<hr>
<p><a name="浏览器是如何渲染页面的"></a></p>
<h2 id="浏览器是如何渲染页面的"><a href="#浏览器是如何渲染页面的" class="headerlink" title="浏览器是如何渲染页面的"></a><strong>浏览器是如何渲染页面的</strong></h2><ul>
<li>根据来自服务器端的HTML代码形成文档对象模型（DOM）</li>
<li>加载并解析样式，形成CSS对象模型</li>
<li>在文档对象模型和CSS对象模型之上，创建一棵由一组待生成渲染的对象组成的渲染树（在Webkit中这些对象被称为渲染器或渲染对象）。render tree能识别样式，上面的每个node都有自己的style，但是render tree中不包含诸如<head>标签或含有display:none属性的不可见元素。</head></li>
<li>对渲染树上的每个元素，计算它的坐标，称之为布局。浏览器采用一种流方法，布局一个元素只需通过一次，但是表格元素需要通过多次。</li>
<li>最后，渲染树上的元素最终展示在浏览器里，这一过程称为“painting”。当用户与网页交互，或者脚本程序改动修改网页时，前面提到的一些操作将会重复执行，因为网页的内在结构已经发生了改变。</li>
</ul>
<p><a name="回流与重绘"></a></p>
<h2 id="回流与重绘"><a href="#回流与重绘" class="headerlink" title="回流与重绘"></a><strong>回流与重绘</strong></h2><p>回流：当Render tree中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流。每个页面至少需要一次回流，就是在页面第一次加载的时候。<br>重绘：当Render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如background-color，叫做重绘。</p>
<p><a name="哪些操作会引起回流或重绘"></a></p>
<h3 id="哪些操作会引起回流或重绘"><a href="#哪些操作会引起回流或重绘" class="headerlink" title="哪些操作会引起回流或重绘"></a><strong>哪些操作会引起回流或重绘</strong></h3><p>其实任何对render tree中元素的操作都会引起回流或者重绘，比如：</p>
<ol>
<li>添加、删除元素(回流+重绘)</li>
<li>隐藏元素，display:none(回流+重绘)，visibility:hidden(只重绘，不回流)</li>
<li>移动元素，比如改变top,left(重绘+回流)</li>
<li>对style的操作(对不同的属性操作，影响不一样)</li>
<li>还有一种是用户的操作，比如改变浏览器大小，改变浏览器的字体大小等(回流+重绘)<br>如果每句JS操作都去回流重绘的话，浏览器可能就会受不了。所以很多浏览器都会优化这些操作，浏览器会维护一个队列，把所有会引起回流、重绘的操作放入这个队列，等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会清空队列，进行一个批处理。这样就会让多次的回流、重绘变成一次回流重绘。</li>
</ol>
<p><a name="如何减少回流或者重绘"></a></p>
<h3 id="如何减少回流或者重绘"><a href="#如何减少回流或者重绘" class="headerlink" title="如何减少回流或者重绘"></a><strong>如何减少回流或者重绘</strong></h3><ul>
<li>当需要设置多个样式时，设置节点的className属性而不是直接操作style属性</li>
<li>让要操作的DOM元素进行”离线处理”，处理完后再一起更新，这里所谓的”离线处理”即让元素不存在于render tree中，比如在向页面添加多个新元素时使用documentFragment或div等元素进行缓存操作，最后再统一添加到页面中。</li>
</ul>
<p><a name="雅虎军规"></a></p>
<h2 id="雅虎军规"><a href="#雅虎军规" class="headerlink" title="雅虎军规"></a><strong>雅虎军规</strong></h2><p>著名的前端优化方案有大名鼎鼎的“雅虎军规”。这里只列出其中的一些条目：</p>
<ul>
<li>压缩<ul>
<li>网页Gzip压缩</li>
<li>JS、CSS源码压缩</li>
</ul>
</li>
<li>缓存<ul>
<li>Add an Expires or a Cache-Control Header 设置头文件过期或者静态缓存</li>
<li>将JS和CSS外链</li>
</ul>
</li>
<li><p>性能</p>
<ul>
<li>避免CSS Expressions</li>
<li>减少iframe数量</li>
<li>缓存DOM节点查找、AJAX查询到的结果</li>
<li>当需要设置的样式很多时候设置className而不是直接操作style属性</li>
<li>用innerHTML代替DOM操作，减少DOM操作次数</li>
<li>减少http请求次数：使用CSS Sprites，使用CDN托管（尽量使用公共库），避免重定向（比如在html中写入链接时，”github.io”和”github.io/“，前者会进一步重定向到后者）</li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li>改善用户体验<ul>
<li>图片预加载</li>
<li>CSS放顶部（让浏览者能尽早的看到网站的完整样式）、JS放底部（在不影响内容表现的情况下）</li>
<li>尽早地释放缓冲（当用户进行页面请求时，服务器端需要花费200到500毫秒时间来拼合HTML，将写在head与body之间，释放缓冲，这样可以将文件头先发送出去，然后再发送文件内容，提高效率）</li>
<li>跨域分离组件（页面组件多个来源可以增大你的平行下载量，但注意不要过多，超过2-4个域名会引起上面说到的DNS查找浪费）</li>
<li>不要出现404页面<br><a name="延伸扩展"></a><h2 id="延伸扩展"><a href="#延伸扩展" class="headerlink" title="延伸扩展"></a><strong>延伸扩展</strong></h2></li>
</ul>
</li>
</ul>
</li>
<li>浏览器在解析域名的时候，是先从”.”开始的，也就是最顶级的域名。<br><a name="iframe的优缺点"></a><h3 id="iframe的优缺点"><a href="#iframe的优缺点" class="headerlink" title="iframe的优缺点"></a><strong>iframe的优缺点</strong></h3>iframe的优点：</li>
<li>解决加载缓慢的第三方内容如图标和广告等的加载问题</li>
<li>Security sandbox（安全沙箱）<ul>
<li>禁止访问父页面的DOM（从技术角度来说，这是因为相对于父页面iframe已经成为不同的源了）</li>
<li>禁止执行脚本</li>
<li>禁止对cookie、本地存储或本地SQL数据库的读写</li>
</ul>
</li>
<li>并行加载脚本<br>缺点：</li>
<li>iframe会阻塞主页面的onload事件；</li>
<li>即使内容为空，加载也需要时间</li>
</ul>
<p><a name="什么是cdn"></a></p>
<h3 id="什么是CDN"><a href="#什么是CDN" class="headerlink" title="什么是CDN"></a><strong>什么是CDN</strong></h3><p>CDN的全称是Content Delivery Network，内容分发网络。使用了CDN缓存后的网站的访问过程为:</p>
<ul>
<li>用户向浏览器提供要访问的域名;</li>
<li>浏览器调用域名解析库对域名进行解析，由于CDN对域名解析过程进行了调整，所以解析函数库一般得到的是该域名对应的CNAME记录，为了得到实际IP地址，浏览器需要再次对获得的CNAME域名进行解析以得到实际的IP地址;在此过程中，使用的全局负载均衡DNS解析，如根据地理位置信息解析对应的IP地址，使得用户能就近访问；</li>
<li>此次解析得到CDN缓存服务器的IP地址，浏览器在得到实际的IP地址以后，向缓存服务器发出访问请求；</li>
<li>缓存服务器根据浏览器提供的要访问的域名，通过Cache内部专用DNS解析得到此域名的实际IP地址，再由缓存服务器向此实际IP地址提交访问请求；</li>
<li>缓存服务器从实际IP地址得得到内容以后，一方面在本地进行保存，以备以后使用，另一方面把获取的数据返回给客户端，完成数据服务过程；</li>
<li>客户端得到由缓存服务器返回的数据以后显示出来并完成整个浏览的数据请求过程。</li>
</ul>
<p><a name="高效的css"></a></p>
<h3 id="高效的css"><a href="#高效的css" class="headerlink" title="高效的css"></a><strong>高效的css</strong></h3><p>浏览器在解析css选择器时是按从右向左的顺序匹配元素的。<br>原则：</p>
<ul>
<li>避免使用通配符</li>
<li>避免使用标签选择器和单个属性选择器作为关键选择器</li>
<li>不要在id选择器前加标签名</li>
<li>尽量不要在选择符定义过多层级，层级越少，同时也降低了css和dom结构的耦合程度，提高样式的可维护性<br>其他css高性能实践</li>
<li>避免使用@import<br>@import导入的新样式文件会阻止页面的并行下载，这样增加了文件的整体加载时间。</li>
<li>避免使用IE浏览器独有样式：图片滤镜和css表达式<br>图片滤镜的使用会在图片加载时阻塞浏览器的加载和渲染，并会增加额外的内存开销。Css表达式的作用是动态设置css属性，表达式不只是有兼容性问题，还有性能问题，例如浏览器大小改动、窗口改动时，会使得浏览器频繁计算，性能消耗极大。同样的效果可以用javascript来实现。<br>另外，在编写超链接样式的时候，要按照下列的顺序：<br>L-V-H-A :  a:link {} a:visited {} a:hover {} a:active {}<br>防止超链接访问过后hover样式就不出现了，以及被点击访问过的超链接样式不再具有hover和active样式了</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/05/04/javascriptSerial-10/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">你所不知道的javascript（十）</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="javascriptSerial-11" data-title="你所不知道的javascript（十一）" data-url="http://yoursite.com/2016/05/05/javascriptSerial-11/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 hbChou
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>